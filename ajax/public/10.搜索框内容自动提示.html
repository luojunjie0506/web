<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.css">
    <script src="Ajax.js"></script>
    <script src="template-web.js"></script>
    <style>
        .container {
            padding-top: 100px;
        }
        .list-group {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-group">
            <input type="text" class="form-control"  placeholder="请输入搜索关键字" id="search">
            <ul class="list-group" id="list-box">
                <li class="list-group-item">提示文字显示的地方</li>
            </ul>
        </div>
        <p id="info"></p> 
    </div>
    <script type='text/html' id='tpl'>
        <!-- 循环从服务器返回值 -->
        {{each result}}
            <!-- $value 循环过程中的当前项 -->
            <li class="list-group-item">{{$value}}</li>
        {{/each}}
    </script>
    <script>
        var searchInp = document.getElementById('search')
        var listBox = document.getElementById('list-box')
        // 储存定时器的变量
        var timer = null
        // oninput 当用户在文本框中输入的时候触发
        searchInp.oninput = function() {
            clearTimeout(timer)
            var key = this.value
            // 判断输入框的值是否为空 trim()方法可以去掉字符串两边空格
            if(key.trim() == 0) {
                listBox.style.display = 'none' 
                // 阻止程序向下执行
                return 
            }
            // 当用户在输入框持续输入时,防止持续发请求,需要添加一个定时器,而且每次触发oninput事件后都要清除定时器,要不然会有很多个定时器
            timer = setTimeout(function() {
                ajax({
                    url:'http://localhost:3000/search',
                    data: {
                        key:key
                    },
                    success:function(result) {
                        // 使用模板将服务器返回的数据和html拼接
                        var html = template('tpl',{result:result})
                        // 将拼接好的模板显示在listBox中
                        listBox.innerHTML = html
                        listBox.style.display = 'block'
                    }
                })
            },800)

        }
        
    </script>
</body>
</html>